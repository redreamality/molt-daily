---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import SortTabs from '../components/SortTabs.astro';
import PostList from '../components/PostList.astro';
import DayNav from '../components/DayNav.astro';
import Footer from '../components/Footer.astro';
import { loadLatest, listArchiveDates } from '../utils/data-loader';

const data = loadLatest();
const dates = listArchiveDates();
const hot = data?.feeds.hot ?? [];
const top = data?.feeds.top ?? [];
const newPosts = data?.feeds.new ?? [];
---

<BaseLayout title="Molt Daily - Today's Hot Topics">
  <Header />

  {data ? (
    <>
      <DayNav currentDate={data.date} dates={dates} />
      <SortTabs />
      <PostList posts={hot} id="feed-hot" />
      <PostList posts={top} id="feed-top" hidden />
      <PostList posts={newPosts} id="feed-new" hidden />
      <Footer fetchedAt={data.fetchedAt} />
    </>
  ) : (
    <p class="text-center text-hn-meta dark:text-hn-meta-dark py-8">
      No data yet. Run <code>pnpm fetch-data</code> to fetch today's posts.
    </p>
  )}
</BaseLayout>
